@using VehicleInformationChecker.Components.UI.MotStatus
@using VehicleInformationChecker.Components.UI.TaxStatus
@if (_isSearching)
{
    <div class="d-flex justify-center pt-4">
        <MudProgressCircular Color="Color.Primary" Size="Size.Large" Indeterminate="true" />
    </div>
}

@if (!String.IsNullOrEmpty(Vehicle!.RegistrationNumber) && !_isSearching)
{
    @if (_isAdditionalSearching)
    {
        <div class="d-flex justify-center">
            <MudSkeleton SkeletonType="SkeletonType.Rectangle" Width="400px" Height="300px"/>
        </div>
    }
    else
    {
        <MudCarousel Style="height:300px;" ShowArrows="true" ShowBullets="false" AutoCycle="false" TData="object">
            <PreviousButtonTemplate>
                <div Class="mud-button-root mud-icon-button mud-icon-button-color-inherit mud-ripple mud-ripple-icon">
                    <span class="mud-icon-button-label">
                        <MudIcon Class="mud-ripple mud-ripple-icon mud-icon-button-size-large" Icon="@Icons.Material.Filled.KeyboardArrowLeft" Color="@Color.Primary" Size="@Size.Large" />
                    </span>
                </div>
            </PreviousButtonTemplate>
            <NextButtonTemplate>
                <div Class="mud-button-root mud-icon-button mud-icon-button-color-inherit mud-ripple mud-ripple-icon">
                    <span class="mud-icon-button-label">
                        <MudIcon Class="mud-ripple mud-ripple-icon mud-icon-button-size-medium" Icon="@Icons.Material.Filled.KeyboardArrowRight" Color="@Color.Primary" Size="@Size.Large" />
                    </span>
                </div>
            </NextButtonTemplate>

            <ChildContent>
                @if (Vehicle.Images.Any())
                {
                    @foreach (var image in Vehicle.Images)
                    {
                        // Preload images
                        <link rel="preload" href="@image.Link" as="image" />

                        <MudCarouselItem Transition="Transition.Fade" Color="@Color.Transparent">
                            <div class="d-flex justify-center">
                                <div style="position:relative; display:inline-block; width:100%; height:300px;">
                                    <MudImage Height="300" Style="max-width:100%; width:100%;" Src="@image.Link" FallbackSrc="@_carPlaceholder" Alt="@image.Title" Class="rounded-lg" ObjectFit="ObjectFit.ScaleDown" ObjectPosition="ObjectPosition.Center" />
                                    <div style="position:absolute; bottom:4px; left:50%; transform:translateX(-50%); color:white; background:rgba(0,0,0,0.3); padding:4px 8px; border-radius:16px;">
                                        <MudText>@image.Index / @Vehicle.Images.Count()</MudText>
                                    </div>
                                </div>
                            </div>
                        </MudCarouselItem>
                    }
                }
                else
                {
                    // Placeholder image if no images are available
                    <MudCarouselItem Transition="Transition.Fade" Color="@Color.Transparent">
                        <div class="d-flex justify-center">
                            <MudImage Height="300" Src="@_carPlaceholder" FallbackSrc="@_carPlaceholder" Alt="Placeholder car" Class="rounded-lg" ObjectFit="ObjectFit.ScaleDown" ObjectPosition="ObjectPosition.Center" />
                        </div>
                    </MudCarouselItem>
                }
            </ChildContent>
        </MudCarousel>
    }

    <MudGrid Class="mt-4">
        <MudItem xs="12" md="8">
            <MudPaper Class="pa-4" Elevation="1">
                <MudText Typo="Typo.h3" Align="Align.Center">@Vehicle.YearOfManufacture @Vehicle.Make @Vehicle.Model</MudText>

                <MudText Typo="Typo.h4">AI Summary</MudText>
                @if (_isAdditionalSearching)
                {
                    <MudSkeleton />
                    <MudSkeleton />
                    <MudSkeleton />
                }
                else
                {
                    <MudText Typo="Typo.body2">
                        @Vehicle.AiSummary <br />
                        <br />
                    </MudText>
                }
                

                <MudText Typo="Typo.h4">Details</MudText>
                <MudText Typo="Typo.body2">
                    Year  :  @Vehicle.YearOfManufacture <br />
                    Make  :  @Vehicle.Make <br />
                    Model  :  @Vehicle.Model <br />
                    Colour  :  @Vehicle.Colour <br />
                    Engine capacity  :  @Vehicle.EngineCapacity <br />
                    Fuel  :  @Vehicle.FuelType <br />
                    <br />
                    Tax status  :  @Vehicle.TaxStatus <br />
                    Tax due date  :  @Vehicle.TaxDueDate <br />
                    MOT status  :  @Vehicle.MotStatus <br />
                    MOT expiry date  :  @Vehicle.MotExpiryDate <br />
                    <br />
                    Last V5C issued  :  @Vehicle.DateOfLastV5CIssued <br />
                    First registered  :  @Vehicle.MonthOfFirstRegistration.ToString("MMMM yyyy") <br />
                    <br />
                </MudText>
            </MudPaper>
        </MudItem>

        <MudItem xs="12" md="4">
            <MudStack Style="height:100%;">
                <MotStatus Vehicle="@Vehicle"></MotStatus>
                <TaxStatus Vehicle="@Vehicle"></TaxStatus>
            </MudStack>
        </MudItem>
    </MudGrid>
}